Глобальный roadmap, чтобы можно было запускать

+- 0 Завести домен и сервер
-- 0.1 Перенести систему на новый сервер
-- 1 Настроить бекап на внешний сервер
++ 2 Скрипты работы с новым csv
   3 отправка уведомлений по почте

Новое ToDo

+- проблема пустых смс
-- добавить параметры фильтрации логов и гейтов. 
+- periodChooser  - автоматическое сужение диапазона по текущему треку -- переделать chooser на другой, более точный, пожелания: кнопки "сброс ограничений", "с последней перевески"
-+ перевешивание смс на другого лося, в т.ч. массовое
-- сделать интерфейс задания паролей для гейтов, переделать им логин на пароль
требования: задавать пароль нужно при создании (любой админ), менять может Супер. И / или должно работать восстановление пароля.

-- ограничение по датам на странице прибора

gitHub
-+ данные уровня приложения в JS

-- Не работает поиск приборов по животным
-- Добавить переходов в интерфейс (напр., переход в админку быстрым путем для приборов)
-- отрисовку точками по дням ???

-- комментарий к приборам и лосям

-+ предупреждение battery low
-+ Уметь показывать на карте точки вместо линий
+- контрол для управления картой: слои, heatmap простой/взвешенный, 

-- Доработки heatmap: как-то побороть "засвет" от лосеферм и подкормочных площадок
-+ Доработки heatmap: поиграть с размером ядра
-- Доработки heatmap: сделать показания измеримыми (avp: изолинии не единственный вариант;
   еще можно зафиксировать min и max и сделать легенду по цветам)
+- наложение активности на точки, взвешенный heatMap?

+- права на логи -- видит записи с доступных ему пользователей. Протекание информации: А состоит в орг. X и Y, B -- в Y. Таким образом B увидит информацию, относящуюся к X
++ права на статистику гейта: пользователь видит инфу по приборам, привязанным к его организациям

++ не давать себя лишать прав на администрирование и т.п.

++ Спрятать secret, использовать device id
++ добавить класс супер-админов -- аналог рута, но со своим логином
++ отмечать точки как невалидные на странице гейта
++ Линию сделать потоньше (2 под просмотр и 3 под печать)
++ Уметь скрывать очевидно битые точки
++ Показывать "кино" или иным образом отображать последний день (avp: может, просто покрасить его чуть ярче?)
++ Убивание СМС
++ Специальные права (зарезервировать ID)
++ При экспорте прибора именовать файл нормально
++ В поиске лосей неплохо бы уметь искать и по номеру телефона тоже (иногда это было бы очень полезно)
++ Уметь показывать информацию по точкам
++ OR в активности

1 +- смс через гейт
2 +- Импорт старых данных

3 +- Проверка прав на все. 
4 ++ Восст. пароля

5 ++ Профиль пользователя
6 ++ управление связкой прибор-лось

7 +- валидация е-мейла и форм

---------------------------------------------------------
-+ Продумать вызов fitBounds, чтобы не мешал сравнивать взвешенные карты.

++ Никак нельзя посмотреть точки с прибора, который в момент посылки смс не был привязан к животному -- подумать, что можно с этим сделать
++ нельзя узнать, кто добавил конкретную смс -- неправда -- raws_sms.user_id
+- таблица с логами!
++ хвост для удаления всех данных от смс по id

-+ проверять, что создается пользователь с мейлом!
проверку на мин. сложность пароля на сервере и клиенте

+- удобный поиск в админке по всем полям, в т.ч. организациям

+- импорт пачки смс из csv файлов по лосю
++ FeatureRequest2: Надо бы сделать, чтобы у AddData был необязательный параметр $Moose, который бы позволял добавить данные из смс не к тому лосю, на котором сейчас висит прибор для импорта исторических данных.

+- права на просмотр пользователя / гейта / орг. 
+- права при редактировании пользователя / гейта / орг  Не путаемся в demo | feed | admin, подсовывания import
+- права на просмотр лося / прибора
+- права при редактировании лося / прибора

Что делать, если лось принадлежит удаленной организации? можно ли менять организацию на другую?

++ reload beacon content on login-logout

++ каноническая форма телефона
смена прав при перелогине! -- о чем это?

++глюк с правами при апдейте пользователя -- стираются организации, на которые у текущего админа нет прав.

++ верстка кнопок сохранить-отменить в профиле (разные марджины)
апдейт имени вверху при сохранении профиля

++ escapeHtml всюду на клиенте
+- SetOrgs, учитывая, что могли быть и до этого

регистрация админом: переделать на отправку токена, и принудительный выбор пароля на подтверждении

+- всюду проверять вход filter_var
++ подгрузка файла аяксом -- Как возвращать ошибки?

++ домен

trim а на сервере?
onBeforeUnload

-+ контрол для сообщений, в т.ч. ошибок, пользователю
+- UI -- придумать разумное расположение панелей.
+- редактирование организаций - а что делать с приписанными приборами / лосями / орг и т.п.?

++ экспорт: чего и во что? -- видимо, в gpx как наиболее общепонятный формат, статистики -- в csv

+- выделить ядро TinyAuth

++ ловля ошибок-дубликатов 1062
++ нормальная выдача ошибок уровня базы и т.п. Exception же!

+- прием смс из интерфейса
++ прием смс с гейта

валидация смс -- похоже, что сейчас расшифруется все, что не выбивается из алфавита
идентификация фидера по телефону гейта -- спец логин для членов группы и метода sms и права только на AddSeries
шифровка сообщения с гейта   см 

https://play.google.com/store/apps/details?id=eu.apksoft.android.smsgateway
https://play.google.com/store/apps/details?id=com.icecoldapps.smsgatewayultimate
https://play.google.com/store/apps/details?id=eu.apksoft.android.smsgateway
https://play.google.com/store/apps/details?id=me.vaas.smsgateway.app
https://play.google.com/store/apps/details?id=ed.sms.webcon
https://play.google.com/store/apps/details?id=net.hablacentro.HablaSMSGateway
https://play.google.com/store/apps/details?id=gfb.janus.free
http://mobisnow.com/app/swift-sms2web/

++ закладки админа и фидера

-------------------------------------------------------------------------------------------
+- админка :(   -- добавление пользователя - гейта с параметром ключ шифрования

удаление лося,  -- а надо?

проверка уникальности имени лося / телефона на клиенте
++ добавление / редактирование телефона, 
++ связка лось - телефон

показывать членство в удаленных организациях при редактировании?
serverside: запрещаем добавлять удаленные организации
какие организации добавлять пользователю по умолчанию? -- все доступные, кроме demo. root -- никакую
запретить редактирование удаленных через UI


++ защита от нескольких лосей, ссылающихся на один телефон

++ пометка телефона inactive

++ добавление / редактирование лося 
++ выбор лося / прибора из списка доступных

++ запретить toggle животным
++ спец режим для single организаций (демо)

++ корректный апдейт при удачном сохранении, в т.ч. поле active;
++ блокировать поиск и 'включая удаленные' при редактировании пользователя 
++ Глюк с редактированием не той строки при наличии скрытых удаленных выше.
++ баг с отрисовкой организаций после редактирования!

++ проверка пустых phone, mooseName на клиенте 
++ trim названиям, логинам и т.п. при создании / редактировании всего
++ валидация контролов в админке, + вывод ошибок,

++ скрыть кнопку "редактировать" при неправильном токене
++ корректный редирект после успешного сброса пароля
++ серверные ошибки при неуспешном сбросе пароля 

-------------------------------------------------------------------------------------------
Концепция прав:
- нужно нормальное деление по правам, в частности против браконьеров.
- чтобы не бояться за всю систему надо создавать изолированные зоны - организации, и пусть ответственный ковыряется в ней как хочет.
- к организациям естественно жестко приписывать лосей и маяки. Людей -- непонятно жестко ли, а гейты (их мало) точно не жестко. Жесто т.е. может быть членом только одной организации.

При этом есть странная организация demo -- в которую точно входят некоторые лоси и маяки, которых можно показывать всем желающим.

Технически видится, что гейты -- это специальные пользователи, которые могут только логиниться через апи.
А организации -- это такие группы.
При этом есть еще выделенные группы: Admins, Feeders -- носители соотв. прав. И выделенный пользователь root, которому можно ва-аще всё.
-------------------------------------------------------------------------------------------
в будущем: коллизия вижу членство в организации, но не могу исправить

++ скрытие хвостов телефонов для незалогиненого пользователя

++ при выборе адресата показывать лося на карте
++ отдавать на клиент активность вместе с лосиными данными

++ пронести проверку прав ближе к базе
++ проверку неудачных логинов

++ avp: разбор активности
++ avp: правильные даты и время в активности и координатах. Кажется, они разъезжаются даже в рамках одной смс.

++ выписка по телефону за период: напряжение, времена, макс время в смс
++ фильтрация выписки по телефону

++ разобраться с порядком загрузки и инициализации яваскрипта